<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
<div class="max-w-md w-full space-y-8">
    <div>
        <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">Sign in to your account</h2>
    </div>
    <form id="loginForm" class="mt-8 space-y-6">
        <div id="error" class="text-red-500 text-sm text-center"></div>
        <div th:if="${param.error}" class="bg-red-50 border border-red-200 text-red-600 p-4 rounded-md">Invalid credentials!</div>
        <div th:if="${param.success}" class="bg-green-50 border border-green-200 text-green-600 p-4 rounded-md">Password reset successful!</div>
        <div>
            <input type="email" id="email" placeholder="Email address" class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm" required>
        </div>
        <div>
            <input type="password" id="password" placeholder="Password" class="appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 focus:z-10 sm:text-sm" required>
        </div>
        <div class="flex items-center justify-between">
            <a href="/forgot-password" class="text-sm text-indigo-600 hover:text-indigo-500">Forgot Password?</a>
        </div>
        <button type="submit" class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Sign in</button>
    </form>
    <div class="mt-6">
        <div class="relative">
            <div class="absolute inset-0 flex items-center">
                <div class="w-full border-t border-gray-300"></div>
            </div>
            <div class="relative flex justify-center text-sm">
                <span class="px-2 bg-white text-gray-500">Or continue with</span>
            </div>
        </div>
        <a th:href="@{/oauth2/authorization/google}" class="mt-3 w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
            <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24"><path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/></svg>
            Sign in with Google
        </a>
        <a th:href="@{/oauth2/authorization/github}" class="mt-3 w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
            <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.775.418-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.643.105-3.372 0 0 1.05-.336 3.44 1.28 1-.28 2.07-.41 3.13-.415 1.06.005 2.13.135 3.13.415 2.39-1.616 3.44-1.28 3.44-1.28.645 1.729.24 3.07.12 3.372.77.84 1.235 1.91 1.235 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.605-.145 2.895-.335 3.305.21.195.48.225.72.135.25-.1.49-.796.49-1.603 0-1.65-.01-2.98-.01-3.02z"/></svg>
            Sign in with GitHub
        </a>
    </div>
    <p class="mt-6 text-center text-sm text-gray-600">
        <a href="/register" class="font-medium text-indigo-600 hover:text-indigo-500">Create account</a>
    </p>
</div>
<script src="/js/app.js"></script>
<script>
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        try {
            const res = await fetch('/api/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            const data = await res.json();
            if (res.ok) {
                localStorage.setItem('token', data.token);
                window.location.href = '/dashboard';
            } else {
                document.getElementById('error').textContent = data || 'Login failed';
            }
        } catch (err) {
            document.getElementById('error').textContent = 'Network error';
        }
    });
</script>
</body>
</html>